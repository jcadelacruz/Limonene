<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>replit</title>
</head>

  <body style="position: fixed; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; font-size: xx-large;
    color: darkslategray; background-color: lightskyblue;
    " id="body">
    <h1 id="hi">MOUSEBOT</h1>
    <p style="text-align: center;">
      X: <span id="x_coordinate"> </span>
      Y: <span id="y_coordinate"> </span>
      Speed: <span id="speed"> </span>
      Angle: <span id="angle"> </span>
    </p>
    <div id="UI">
      <button id="moveBtnA" class="moveBtn UI">A</button>
      <button id="moveBtnB" class="moveBtn UI">B</button>
      <div id="joystick" class="UI"></div>
    </div>
    </body>
<!---------------------------------------------->
  <style>
    /* Disable text selection for the entire page */
    body {
        user-select: none;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    /* Enable text selection for specific elements if needed */
    .allow-select {
        user-select: text;
        -moz-user-select: text;
        -webkit-user-select: text;
        -ms-user-select: text;
    }
    h1{
      text-align:center;
    }
    .UI{
      z-index: 100;
      position: fixed;
      opacity: 0.7;
    }
    .moveBtn{
      width: 100px; height: 100px;
      border-radius: 100%;
      margin: 10px;
    }
    #moveBtnA{ bottom: 0; right: 100px;}
    #moveBtnB{ bottom: 100px; right: 0;}
    #joystick{
      background-color: lightgreen;
      border-radius: 100%;
      
      bottom: 0; left: 0;
    }
    #joystick > *{
      background-color: lightgreen;
      border-radius: 100%;
    }
  </style>
<!---------------------------------------------->
  <script>
  //WINDOW functions
    window.addEventListener('load', () => {
      // Disable pinch zoom on the document
      document.addEventListener('touchmove', function(event) {
        if (event.touches.length > 1) {
            event.preventDefault();
        }
      }, { passive: false });

      resize(); 
      window.addEventListener('resize', resize);

      initializeJoystickAndFunctions();

      moveBtnA.addEventListener('touchstart', btnAFunction);
      moveBtnB.addEventListener('touchstart', btnBFunction);
    });
    function resize(){
      let width = window.innerWidth; let height = window.innerHeight;
      resizeTo(width, height);
    }

  //MOVE BUTTON functions
    function kob(){
      document.getElementById("body").style.backgroundColor = "purple";
    }
    function bok(){
      document.getElementById("body").style.backgroundColor = "yellow";
    }

    function btnAFunction(){
      document.getElementById("body").style.backgroundColor = "blue";
    }
    function btnBFunction(){
      document.getElementById("body").style.backgroundColor = "orange";
    }

  //JOYSTICK functions
    var joystick = document.getElementById('joystick'), joystickMovable;
    const INITIALRADIUS = 60, INITIALMARGIN = 40;
    var radius = INITIALRADIUS, posX = 0, posY = 0, spd = 0, angl = 0;
    var joystickClicked = false;

    function initializeJoystickAndFunctions(){
      //making joystick + css
      makeJoystick();
      joystick.style.margin = INITIALMARGIN+"px";
      
      //mouse controls
      joystick.addEventListener('mousedown', startJoystick);
      window.addEventListener('mouseup', stopJoystick);
      window.addEventListener('mouseleave', stopJoystick);
      window.addEventListener('mousemove', moveJoystick);
      //touch controls
      joystick.addEventListener('touchstart', startJoystick);
      joystick.addEventListener('touchend', stopJoystick);
      //joystick.addEventListener('touchcancel', stopJoystick);
      body.addEventListener('touchmove', moveJoystick);
      //TEST display buttons
      document.getElementById("x_coordinate").innerText = 0;
      document.getElementById("y_coordinate").innerText = 0;
      document.getElementById("speed").innerText = 0;
      document.getElementById("angle").innerText = 0;
    }
      //computing css changes
    function makeJoystick() {
      joystick.style.width = radius*2+"px";
      joystick.style.height = radius*2+"px";
      joystick.style.backgroundColor = "red";
    }
    function makeJoystickMovable() {
      joystickMovable.style.width = INITIALRADIUS*2+"px";
      joystickMovable.style.height = INITIALRADIUS*2+"px";
      joystickMovable.style.backgroundColor = "red";
      joystickMovable.style.position = "fixed";
    }
    function changeRadius(int){
      joystick.style.margin =  parseInt(window.getComputedStyle(joystick).margin, 10) - (int-radius) + "px";
      radius = int;
    }
      //computing changes to variables
    function updatePos(e){
      //pos
      if(e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel'){
        posX = e.touches[0].clientX;
        posY = e.touches[0].clientY;
      } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover'|| e.type=='mouseout' || e.type=='mouseenter' || e.type=='mouseleave') {
        posX = e.clientX;
        posY = e.clientY;
      }
      var marginVal = parseInt(window.getComputedStyle(joystick).margin, 10);
      posY = window.innerHeight - posY - radius - marginVal;
      posX -= marginVal + radius;
      //speed
      spd = Math.sqrt((posX*posX) + (posY*posY)) / radius;
      checkIfWithinRadius();
        //finalize spd
        spd = Math.round(spd*100)/100;
      //angle
      angl = Math.atan(posY/posX);
      angl = (posX<0) ? ((posY<0)?angl+Math.PI:Math.PI+angl) : ((posY<0)?(2*Math.PI)+angl:angl);
        //convert to degrees if u want
      angl *= (180)/Math.PI;
    }
    function checkIfWithinRadius(){
      if(spd>1){
        posX /= spd; posY /= spd;
        spd = 1;
      }
    }
    /*function isItWithinRadius() {
      var distance = (posX*posX) + (posY*posY);
      if ( distance < radius*radius ) return true;
      else return false;
    }*/
    //event functions
    function startJoystick(event) {
      //make movable part of joystick in html
      joystickMovable = document.createElement('div');
      makeJoystickMovable();
      joystick.appendChild(joystickMovable);
      //start the joystick
      joystickClicked = true;
      changeRadius(85);
      makeJoystick();
      joystick.style.backgroundColor = "lightgreen";
      //update
      moveJoystick(event);
    }
    function stopJoystick() {
      //delete movable part of joystick in html
      joystick.innerText = "";
      //stop the joystick
      joystickClicked = false;
      changeRadius(60);
      makeJoystick();
      joystick.style.backgroundColor = "red";
      //reset stats
      resetStats();
      displayStats();
    }
    function moveJoystick(event) {
      if (joystickClicked){
        //update position
        updatePos(event);
        displayStats();
        //move joystickMovable
        moveJoystickMovable();
      }
    }
    //moving joystick movable
    function moveJoystickMovable(){
      var marginVal = parseInt(window.getComputedStyle(joystick).margin, 10);
      joystickMovable.style.left = marginVal + radius - INITIALRADIUS + posX + "px";
      joystickMovable.style.bottom = marginVal + radius - INITIALRADIUS + posY + "px";
    }
    //display functions
    function displayStats(){
      x_coordinate.innerText = Math.floor(posX);
      y_coordinate.innerText = Math.floor(posY);
      speed.innerText = spd;
      angle.innerText = Math.floor(angl*100)/100;
    }
    function resetStats(){
      posX=0; posY=0; spd=0; angl=0;
    }
  </script>

</html>