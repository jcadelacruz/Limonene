<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Limonene_replit</title>
</head>

  <body style="position: fixed; font-family: 'Lucida Console', 'Courier New','Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; text-align: left; font-weight: bolder;
    color: darkslategray; background-color: lightslategray;
    " id="body">
    <p style="font-size: 20px; white-space: pre;">
X:<span id="x_coordinate"></span><span id="e1"></span>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Sem et tortor consequat id porta nibh venenatis. Etiam dignissim diam quis enim. Pellentesque id nibh tortor id. Quis imperdiet massa tincidunt nunc pulvinar sapien et. Nunc faucibus a pellentesque sit amet porttitor.
Y:<span id="y_coordinate"></span><span id="e2"></span>Quis viverra nibh cras pulvinar mattis nunc sed blandit. Velit scelerisque in dictum non consectetur a erat nam. Nibh cras pulvinar mattis nunc sed blandit libero volutpat sed. Nisl pretium fusce id velit ut. Orci ac auctor augue mauris. Dui vivamus arcu felis bibendum ut tristique et. Elit ullamcorper dignissim cras tincidunt lobortis feugiat.
Speed:<span id="speed"></span><span id="e3"></span>Viverra aliquet eget sit amet tellus cras adipiscing enim. Volutpat sed cras ornare arcu. Fringilla ut morbi tincidunt augue interdum. Pulvinar etiam non quam lacus suspendisse faucibus. Quisque egestas diam in arcu. Sed nisi lacus sed viverra tellus.
Angle:<span id="angle"></span><span id="e4"></span>Sit amet consectetur adipiscing elit pellentesque habitant morbi tristique senectus. Et malesuada fames ac turpis egestas maecenas. Vitae suscipit tellus mauris a diam maecenas sed. Magna eget est lorem ipsum dolor sit amet consectetur adipiscing.
    </p>
    <div id="playArea"></div>
    <div id="UI">
      <button id="moveBtnA" class="moveBtn UI">A</button>
      <button id="moveBtnB" class="moveBtn UI">B</button>
      <div id="inventoryDiv" class="UI" style="visibility: hidden;">
      </div>
    </div>
    </body>
<!---------------------------------------------->
  <style>
    html, body{ overscroll-behavior-y: contain;}
    /* Disable text selection for the entire page */
    body {
        user-select: none; -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;
    }
    /* Enable text selection for specific elements if needed */
    .allow-select {
        user-select: text; -moz-user-select: text; -webkit-user-select: text; -ms-user-select: text;
    }
    h1{
      text-align:center;
    }
    .room{
      background-color: royalblue;
      z-index: 1;
    }
    .room>div{
      background-color: darkviolet;
      z-index: 5;
      position: absolute;
    }
    #playArea{
      position: absolute;
      top: 0; left: 0;
    }
    .pausedDivs{
      width: 100%; 
      height: 100%; 
      opacity: 50%; 
      position: fixed; top: 0; left: 0; 
      display: flex; justify-content: center; align-items: center; 
    }
    .UI, #UI>*{
      z-index: 100;
      position: fixed;
      opacity: 0.7;
    }
    #pauseDiv>*{
      background-color: green;
      width: 100px;
      height: 100px;
      opacity: 0.9;
      margin: 30px;
    }
    .moveBtn{
      width: 100px; height: 100px;
      border-radius: 100%;
      margin: 10px;
    }
    #moveBtnA{ bottom: 0; right: 100px;}
    #moveBtnB{ bottom: 100px; right: 0;}
    #joystick{
      background-color: lightgreen;
      border-radius: 100%;
      
      bottom: 0; left: 0;
    }
    #joystick > *{
      background-color: lightgreen;
      border-radius: 100%;
    }
  </style>
<!---------------------------------------------->
  <script>
  //WINDOW functions
    
    var FRAMERATE = 24, timer, screenWidth = window.innerWidth, screenHeight = window.innerHeight;
    const UI_ZINDEX = 100, PAUSE_ZINDEX = UI_ZINDEX + 1, BG_ZINDEX = 1, ENTITY_ZINDEX = 5, MSG_ZINDEX = 40;//Play area z index should be below 50 
    window.addEventListener('load', () => {
      document.addEventListener('touchmove', function(event) {if (event.touches.length > 1) { event.preventDefault();}}, { passive: false });// Disable pinch zoom on the document
        //display stuff
      resize(); 
      window.addEventListener('resize', resize);
      window.addEventListener('deviceorientation', resize);
        //update
      startTimer();
        //UI
      initializeJoystickAndFunctions();
      initializeMoveButtons();
      initializePauseBtn();
        //game instances
      initializeInstances();
    });
    function resize(){
      screenWidth = window.innerWidth; screenHeight = window.innerHeight;
      resizeTo(screenWidth, screenHeight);
    }
    function startTimer(){ timer = setInterval(update, 1000/FRAMERATE);}
    //GENERAL functions
    let dturn = 0;
      function update(){
        currentRoom.display();
        currentRoom.updatePopulation();
      }

  //GAME INSTANCES
    function initializeInstances(){
      //weapons
      //room
      var r00 = new Room("home", 0,0, roomSize/2,0);
      var r01 = new Room("cross", 0,1, roomSize/2,0);
      var r11 = new Room("kitchen", 1,1, 0,roomSize/2);
      var rn11 = new Room("badlands", -1,1, roomSize,roomSize/2);
      var r02 = new Room("heaven", 0,2, roomSize/2,0);
      roomList = [r00, r01, r11, rn11, r02];
      //entities
      var e01_01 = new Entity(100, 10, 2, 0,2*roomSize/5);
      var e01_02 = new Entity(100, 10, 2, 20,2*roomSize/5);
      var e01_03 = new Entity(100, 10, 2, 30,2*roomSize/5);
      var e01_04 = new Entity(100, 10, 2, 40,2*roomSize/5);
      var e01_11 = new Entity(100, 10, 2, 0,roomSize/5);
      var e01_12 = new Entity(100, 10, 2, 20,roomSize/5);
      var e01_13 = new Entity(100, 10, 2, 30,roomSize/5);
      var e01_14 = new Entity(100, 10, 2, 40,roomSize/5);
      var e01_21 = new Entity(100, 10, 2, 0,3*roomSize/5);
      var e01_22 = new Entity(100, 10, 2, 20,3*roomSize/5);
      var e01_23 = new Entity(100, 10, 2, 30,3*roomSize/5);
      var e01_24 = new Entity(100, 10, 2, 40,3*roomSize/5);
      r01.entityPopulation = [];
        //player
      player = new Player(100, 10, 0, 0,0);
      r00.entityPopulation = [e01_02, e01_03]//, e01_04, e01_011, e01_012, e01_013, e01_014, e01_021, e01_022, e01_023, e01_024];
      r01.entityPopulation = [player, e01_01];
      currentRoom = r01;

      initializeAllPopulationsInRoomList();
      currentRoom.enter();
    }
    function initializePlayer(){}
    function initializeAllPopulationsInRoomList(){
      let l = roomList.length;
      for(let i=0; i<l; i++){
        roomList[i].initializePopulation();
      }
    }

      //WEAPONS
    class Bullet{
      constructor(w, s, sz, dir, x,y){
        this.weapon = w;
        this.speed = s; this.size = sz; this.direction = dir;
        this.x = x; this.y = y;
        
        let d = document.createElement('div');
          d.classList.add("bullet");
          d.style.width = sz+"px";d.style.height = sz+"px";
          d.style.backgroundColor = "white";
          d.style.borderRadius = "65%";
          d.style.rotate = dir+"rad";
        document.getElementById(currentRoom.name).appendChild(d);
        this.disp = d;
      }
      update(){
        this.move();
        this.executeEffect(this.collides());
        this.display();
      }
      move(){
        let x = this.x + Math.cos(this.direction) * this.speed;
        let y = this.y + Math.sin(this.direction) * this.speed;
        let s = this.size;
        if(x<=0) this.x = 0;
        else if(x+s>=roomSize) this.x = roomSize-s;
        else this.x = x;
        if(y<=0) this.y = 0;
        else if(y+s>=roomSize) this.y = roomSize-s;
        else this.y = y;
      }
      collides(){//pseudocode
        let col = false;
        let entity = "";
        if(1<2) return entity; 
        return col;
      }
      executeEffect(e){//pseudocode
        if(e===-1) return;
      }
      display(){
        this.disp.style.left = this.x + "px";
        this.disp.style.bottom = this.y + "px";
      }
    }
    class Weapon{
      constructor(bS,r,bSz,s,   bC,rD,mS,   d, m,   k,   sK,w){
        this.bulletSpeed = bS; this.range = r; this.bulletSize = bSz, this.spread = s;//bullet movement identity
        this.bulletCount = bC; this.reloadDuration = rD; this.magSize = mS;//bullet use identity
        this.damage = d; this.magicEffect = m; this.knockback = k;//victim effects
        this.shooterKnockback = sK; this.weight = w;//shooter effects (active vs passive)

        this.bullets = [];
      }
      executeWeaponFunction(e){
        let aimDir = e.moveAngle;
        for(let i = 0; i < this.bulletCount; i++){
          let es2 = entitySize/2;
          let b = new Bullet(this, this.bulletSpeed, this.bulletSize, aimDir, e.x+(es2), e.y+(es2));
          this.bullets.push(b);
          aimDir += this.spread;
        }
      }
      unequip(){
        for(let i = 0; i < this.bullets.length; i++){
          this.bullets[i].disp.remove();
        }
        bullets = [];
      }
      update(){
        for(let i = 0; i < this.bullets.length; i++){
          this.bullets[i].update();
        }
      }
    }
      //ROOM
    var roomList = [];
    var currentRoom;
    const roomSize = 500;
    class Room{
      constructor(n, x, y, ex, ey){
        this.name = n;
        this.entityPopulation = [];
        this.exitX = ex; this.exitY = ey;
        this.x = x; this.y = y;
      }
      updatePopulation(){
        let l = this.entityPopulation.length;
        let r = currentRoom;
        for(let i = 0; i < l; i++){
          try{
            this.entityPopulation[i].update();
            this.entityPopulation[i].display();
          }
          catch(err){}
        }
      }
      initializePopulation(){
        let l = this.entityPopulation.length;
        for(let i = 0; i < l; i++){
          this.entityPopulation[i].inGame = true;
        }
      }
      initializeDisplay(){
        if(document.getElementById(this.name)!=null) return;
        let room = document.createElement('div');
        room.id = this.name;
        room.classList.add("room");
        room.style.width = roomSize + "px";
        room.style.height = roomSize + "px";
        room.style.position = "relative";
        let p =document.createElement('p');
        p.innerText = this.name;
        room.appendChild(p);
        document.getElementById('playArea').appendChild(room);

        let l = this.entityPopulation.length;
        for(let i = 0; i < l; i++){
          this.entityPopulation[i].initializeDisplay();
        }
      }
      display(){
        let c = document.getElementById(this.name);
        c.style.left = (screenWidth/2)-player.x +"px";
        c.style.top = (screenHeight/2)+player.y-roomSize +"px";
      }
      enter(){
        currentRoom = this;
        this.initializeDisplay();
      }
      entityTransfersTo(r, e){
        console.log("transfering to "+r.x+","+r.y);
        let originalArray = this.entityPopulation, newArray = r.entityPopulation;
        let indexToRemove = originalArray.indexOf(e);

        if (indexToRemove !== -1) {
            // Remove the element from the original array and add it to the new array
            newArray.push(originalArray.splice(indexToRemove, 1)[0]);

            console.log("Original Array:", originalArray);
            console.log("New Array:", newArray);
        } else {
            console.log("Element not found in the original array");
        }

        //remove display
        document.getElementById(currentRoom.name).removeChild(e.disp);
      }
      leave(){
        document.getElementById('playArea').removeChild(document.getElementById(this.name));
      }
    }
    function getRoom(x,y){
      let l = roomList.length;
      for(let i = 0; i<l; i++){
        if(roomList[i].x == x && roomList[i].y == y) return roomList[i];
      }
      return -1;
    }
      //ENTITY
    var player;
    const sightRange = 150, sightRangeSquared = sightRange*sightRange, attackRange = 30, attackRangeSquared = attackRange*attackRange, entitySize = 50;
    class Entity{
      constructor(h, s, sp, x, y){
        //attack
        this.maxHP = h;
        this.hp = h;
        this.str = s;
        //position
        this.speed = sp;
        this.inGame = false;
        this.x = x; this.y = y;
        this.moveAngle = 0;
        this.trackingPlayer = true;
        //display
        this.disp = null;
      }
      move(){
        let x = this.x + Math.cos(this.moveAngle) * this.speed;
        let y = this.y + Math.sin(this.moveAngle) * this.speed;
        if(x<=0) this.x = 0;
        else if(x+entitySize>=roomSize) this.x = roomSize-entitySize;
        else this.x = x;
        if(y<=0) this.y = 0;
        else if(y+entitySize>=roomSize) this.y = roomSize-entitySize;
        else this.y = y;
      }
      update(turn){
        //pathfinding
        let px = player.x - this.x; let py = player.y - this.y;
        let d = (px*px)+(py*py);
        if( d<=sightRangeSquared){//checking if entity is near the player
          let m = Math.atan(py/px);
          this.moveAngle = (px<0) ? ((py<0)?m+Math.PI:Math.PI+m) : ((py<0)?(2*Math.PI)+m:m);
          this.trackingPlayer = true;
          if(d<=attackRangeSquared){
            this.attackPlayer();
            return;//to give player space ig?
          }
        }
        else{//case; not near player
          //if(this.trackingPlayer===true){
            px = currentRoom.exitX - this.x - entitySize/2; py = currentRoom.exitY - this.y - entitySize/2;
            let m = Math.atan(py/px);
            this.moveAngle = (px<0) ? ((py<0)?m+Math.PI:Math.PI+m) : ((py<0)?(2*Math.PI)+m:m);
            this.trackingPlayer = false;
          //}
          //check if near exit of room
          if(this.contains(currentRoom.exitX, currentRoom.exitY)){ this.transferRooms();}
        }
        //movement
        this.move();
      }
      findRoomAtDirection(){
        let dir = (currentRoom.exitX!==roomSize/2) ? ((currentRoom.exitX===0)? "left" : "right") : ((currentRoom.exitY===0)? "down" : "up" );
        let r = currentRoom;
        switch(dir){
          case "left":
            r = getRoom(currentRoom.x-1, currentRoom.y);
            if(r===-1)break;
            console.log("going left");
            this.x = roomSize-entitySize-1; this.y = roomSize/2;
            break;
          case "right":
            r = getRoom(currentRoom.x+1, currentRoom.y);
            if(r===-1)break;
            console.log("going right");
            this.x = 1; this.y = roomSize/2;
            break;
          case "down":
            r = getRoom(currentRoom.x, currentRoom.y-1);
            if(r===-1)break;
            console.log("going down: "+currentRoom.x+","+currentRoom.y);
            this.x = roomSize/2; this.y = roomSize-entitySize-1;
            break;
          case "up":
            r = getRoom(currentRoom.x, currentRoom.y+1);
            if(r===-1)break;
console.log("going up");
            this.x = roomSize/2; this.y = 1;
            break;
        }
        return r;
      }
      transferRooms(){
        let r = this.findRoomAtDirection();
        if(r!==-1)currentRoom.entityTransfersTo(r, this);
      }
      contains(x, y){
        let m = 8;//margin of error
        if( (this.x-m<x && x<this.x+m+entitySize) && (this.y-m<y && y<this.y+m+entitySize) ) return true;
      }
      display(){
       // console.log("entity: "+this.hp+"/"+this.maxHP+" at ("+this.x+","+this.y+")");
        this.disp.style.left = this.x + "px";
        this.disp.style.bottom = this.y + "px";
      }
      initializeDisplay(){
        let en = document.createElement('div');
        en.classList.add("entity");
        en.style.width = entitySize + "px";
        en.style.height = entitySize + "px";
        en.style.left = this.x + "px";
        en.style.bottom = this.y + "px";
        document.getElementById(currentRoom.name).appendChild(en);
        this.disp = en;
      }
      attackPlayer(){
        
      }
    }
    class Player extends Entity{
      update(){
        //check if near exit of room
        let gap = 5;
        if(this.contains(0,roomSize/2)){
          if(this.transferRoomsTo(-1,0)===1)//left
          {this.x = roomSize-entitySize-gap; this.y = roomSize/2;}
        }
        else if(this.contains(roomSize,roomSize/2)){
          if(this.transferRoomsTo(1,0)===1)//right
          {this.x = gap; this.y = roomSize/2;}
        }
        else if(this.contains(roomSize/2,0)){
          if(this.transferRoomsTo(0,-1)===1)//down
          {this.x = roomSize/2; this.y = roomSize-entitySize-gap;}
        }
        else if(this.contains(roomSize/2,roomSize)){
          if(this.transferRoomsTo(0,1)===1)//up
          {this.x = roomSize/2; this.y = gap;}
        }
        //move
        this.move();
        //weapons
        this.updateEquippedWeapons();
      }
      transferRoomsTo(xAdd, yAdd){
        let r = getRoom(currentRoom.x+xAdd, currentRoom.y+yAdd);
        //let r = this.findRoomAtDirection();
        if(r!==-1){
          currentRoom.entityTransfersTo(r, this);
          currentRoom.leave();
          r.enter();
          return 1;
        }
        else return -1;
      }
      contains(x, y){
        let m = 2;//margin of error
        if( (this.x-m<x && x<this.x+m+entitySize) && (this.y-m<y && y<this.y+m+entitySize) ) return true;
      }
      initializeDisplay(){
        let en = document.createElement('div');
        en.classList.add("entity");
        en.style.width = entitySize + "px";
        en.style.height = entitySize + "px";
        en.style.left = this.x + "px";
        en.style.bottom = this.y + "px";
        en.style.backgroundColor = "red";
        document.getElementById(currentRoom.name).appendChild(en);
        this.disp = en;
      }
      updateEquippedWeapons(){
        let weapons = [moveBtnA.weapon, moveBtnB.weapon];
        for(let i = 0; i<weapons.length; i++){
          if(weapons[i]!==null) weapons[i].update();
        }
      }
    }

  //UI BUTTON functions
    var pauseBtn, pauseDiv;
    var inventoryBtn, settingsBtn, quitBtn;
    var inventoryDiv, settingsDiv, quitDiv;
    function initializePauseBtn(){
      //PAUSE BUTTON
      pauseBtn = document.createElement('button');
      pauseBtn.id = "pauseBtn";
      pauseBtn.style = "width: 62px; height: 62px; border-color: black; border-width: 4px; margin: 20px; border-radius: 10%; background-color: lightgreen; position: fixed; top: 0; right: 0; z-index: "+PAUSE_ZINDEX+";";
      document.getElementById("UI").appendChild(pauseBtn);
        //functions
      pauseBtn.addEventListener('touchstart', pause);
      pauseBtn.addEventListener('mousedown' , pause);
      //PAUSED DIV
      pauseDiv = document.createElement('div'); pauseDiv.id = "pauseDiv";
      pauseDiv.style = "background-color: black; z-index: "+(PAUSE_ZINDEX-1)+";";
      pauseDiv.style.visibility = "hidden";
      pauseDiv.classList.add('pausedDivs');
      document.getElementById('body').appendChild(pauseDiv);
        //within div
      initializePauseContents();
    }
    function initializePauseContents(){
        //buttons
      inventoryBtn = document.createElement('button'); inventoryBtn.id = "inventoryBtn";
      inventoryBtn.innerText = "Inventory";
      inventoryDiv = document.getElementById('inventoryDiv');
      inventoryDiv.style = "background-color: black; z-index: "+(PAUSE_ZINDEX-1)+";";
      inventoryDiv.style.visibility = "hidden";

      settingsBtn = document.createElement('button'); settingsBtn.id = "settingsBtn";
      settingsBtn.innerText = "Settings";
      settingsDiv = document.getElementById('settingsDiv');

      quitBtn = document.createElement('button'); quitBtn.id = "quitBtn";
      quitBtn.innerText = "Quit";
      quitDiv = document.getElementById('quitDiv');
        //adding
      pauseDiv.appendChild(inventoryBtn);
      pauseDiv.appendChild(settingsBtn);
      pauseDiv.appendChild(quitBtn);
    }
      //INVENTORY
    function openInventory(){
      console.log("inventory");
      pauseDiv.style.visibility = "hidden";
      inventoryDiv.style.visibility = "visible";
    }
    function closeInventory(){
      
    }
      //SETTINGS
    function openSettings(){
      console.log("settings");
    }
      //QUIT
    function quitGame(){
      console.log("quit");
    }

      //PAUSE
    function replacePauseBtnFunction(d){
      pauseBtn.removeEventListener('touchstart', unpause);
      pauseBtn.removeEventListener('mousedown' , unpause);
      if(d===inventoryDiv){
        pauseBtn.addEventListener('click', closeInventory);
      }else if(d===settingsDiv){
        pauseBtn.addEventListener('click', closeSettings);
      }else if(d===quitDiv){
        pauseBtn.addEventListener('click', closeQuit);
      }
      
    }
    function pause(){
      clearInterval(timer);
      //make all pause elements visible
      pauseDiv.style.visibility = "visible";
      //make pauseBtn to unpause
      pauseBtn.removeEventListener('touchstart', pause);
      pauseBtn.removeEventListener('mousedown' , pause);
      setTimeout(() => {
        pauseBtn.addEventListener('touchstart', unpause);
        pauseBtn.addEventListener('mousedown' , unpause);
        inventoryBtn.addEventListener('click', openInventory);
        settingsBtn.addEventListener('click', openSettings);
        quitBtn.addEventListener('click', quitGame);
      }, 1000);
    }
    function unpause(){
      //remove all elements visibility
      pauseDiv.style.visibility = "hidden";
      //re set pause btn
      pauseBtn.removeEventListener('touchstart', unpause);
      pauseBtn.removeEventListener('mousedown' , unpause);
      setTimeout(() => {
        pauseBtn.addEventListener('touchstart', pause);
        pauseBtn.addEventListener('mousedown' , pause);
      }, 1000);
      //timer start
      startTimer();
    }
  //MOVE BUTTON functions
    var moveBtnA, moveBtnB;
    function initializeMoveButtons(){
      moveBtnA = new MoveBtn(document.getElementById('moveBtnA'), "yellow");
      moveBtnB = new MoveBtn(document.getElementById('moveBtnB'), "blue");
      //moveBtnB.setWeapon(new Weapon(1,2,3,4,5,6,7,8,9));//test
    }
    class MoveBtn{
      constructor(buttonElement, color){
        this.htmlElement = buttonElement;
        this.htmlElement.addEventListener('touchstart', this.unequippedWeaponFunction);
        this.htmlElement.addEventListener('mousedown' , this.unequippedWeaponFunction);
        this.color = color;
        this.htmlElement.style.backgroundColor = color;

        this.weapon = null;
        this.executeWeaponFunction = this.executeWeaponFunction.bind(this);
      }
      setWeapon(weapon){
        if(this.weapon!==null){
          this.weapon.unequip();
          this.htmlElement.removeEventListener('touchstart', this.executeWeaponFunction);
          this.htmlElement.removeEventListener('mousedown' , this.executeWeaponFunction);
        }
        else{
          this.htmlElement.removeEventListener('touchstart', this.unequippedWeaponFunction);
          this.htmlElement.removeEventListener('mousedown' , this.unequippedWeaponFunction);
        }
        this.weapon = weapon;
        this.htmlElement.addEventListener('touchstart', this.executeWeaponFunction);
        this.htmlElement.addEventListener('mousedown' , this.executeWeaponFunction);
      }
      unequippedWeaponFunction(){
        console.log("button has no equipped weapon");
      }
      executeWeaponFunction(){
        this.weapon.executeWeaponFunction(player);
      }
    }
    /*function kob(){
      document.getElementById("body").style.backgroundColor = "blue";
    }
    function bok(){
      document.getElementById("body").style.backgroundColor = "yellow";
    }

    function btnAFunction(){
      document.getElementById("body").style.backgroundColor = "blue";
    }
    function btnBFunction(){
      document.getElementById("body").style.backgroundColor = "orange";
    }*/

  //JOYSTICK functions
    const INITIALRADIUS = 60, INITIALMARGIN = 40;
    function initializeJoystickAndFunctions(){
      //making joystick + css
      joystick = new Joystick();
      joystick.displayStats();
    }
    class Joystick{
      constructor(){
        //joystick = this;
        //values
        this.radius = INITIALRADIUS;
        this.posX = 0; this.posY = 0;
        this.spd = 0; this.angl = 0;
        //binding functions
        this.myMoveJoystick = this.moveJoystick.bind(this);
        this.myStartJoystick = this.startJoystick.bind(this);
        this.myStopJoystick = this.stopJoystick.bind(this);
        //htmlElement
        let h = document.createElement('div'); h.id = 'joystick';
        h.style.width = this.radius*2+"px"; h.style.height = this.radius*2+"px";
        h.style.backgroundColor = "red";
        h.style.margin = INITIALMARGIN+"px";
          //mouse controls
        h.addEventListener('mousedown', this.myStartJoystick);
        window.addEventListener('mouseup', this.myStopJoystick);
        window.addEventListener('mouseleave', this.stopJoystick);
        window.addEventListener('mousemove', this.myMoveJoystick);
          //touch controls
        h.addEventListener('touchstart', this.myStartJoystick);
        h.addEventListener('touchend', this.myStopJoystick);
          //joystick.addEventListener('touchcancel', myStopJoystick);
        document.getElementById('body').addEventListener('touchmove', this.myMoveJoystick);
          //TEST display buttons
        document.getElementById("x_coordinate").innerText = 0;
        document.getElementById("y_coordinate").innerText = 0;
        document.getElementById("speed").innerText = 0;
        document.getElementById("angle").innerText = 0;
          //append
        this.htmlElement = h;
        document.getElementById('UI').appendChild(this.htmlElement);
        this.joystickClicked = false;
        //joystickMovable
        this.joystickMovable = document.createElement('div');
      }
        //computing css changes
      makeJoystick(){
        this.htmlElement.style.width = this.radius*2+"px";
        this.htmlElement.style.height = this.radius*2+"px";
        this.htmlElement.style.backgroundColor = "red";
      }
      makeJoystickMovable() {
        this.joystickMovable.style.width = INITIALRADIUS*2+"px";
        this.joystickMovable.style.height = INITIALRADIUS*2+"px";
        this.joystickMovable.style.backgroundColor = "red";
        this.joystickMovable.style.position = "fixed";
      }
      changeRadius(int){
        this.htmlElement.style.margin = parseInt(window.getComputedStyle(this.htmlElement).margin, 10) - (int-this.radius) + "px";
        this.radius = int;
      }
        //computing changes to variables
      updatePos(e){
        //pos
        if(e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel'){
          this.posX = e.touches[0].clientX;
          this.posY = e.touches[0].clientY;
        } else if (e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover'|| e.type=='mouseout' || e.type=='mouseenter' || e.type=='mouseleave') {
          this.posX = e.clientX;
          this.posY = e.clientY;
        }
        let marginVal = parseInt(window.getComputedStyle(this.htmlElement).margin, 10);
        this.posY = window.innerHeight - this.posY - this.radius - marginVal;
        this.posX -= marginVal + this.radius;
        //speed
        this.spd = Math.sqrt((this.posX*this.posX) + (this.posY*this.posY)) / this.radius;
        this.checkIfWithinRadius();
          //finalize spd
          this.spd = Math.round(this.spd*100)/100;
        //angle
        this.angl = Math.atan(this.posY/this.posX);
        /*if((Math.PI/4)>this.angl && this.angl>(-Math.PI/4)){this.angl = 0;}
        else if(this.angl<0){ this.angl = -Math.PI/2;}
          else {this.angl = Math.PI/2;}*///use 4 cardinal directions

        this.angl = (this.posX<0) ? (Math.PI+this.angl) : ((this.posY<0)?(2*Math.PI)+this.angl:this.angl);
          //convert to degrees if u want
        //this.angl *= (180)/Math.PI;
        this.translateStats();
      }
      checkIfWithinRadius(){
        if(this.spd>1){
          this.posX /= this.spd; this.posY /= this.spd;
          this.spd = 1;
        }
      }
        //event functions
      startJoystick(event) {
        //make movable part of joystick in html
        this.makeJoystickMovable();
        this.htmlElement.appendChild(this.joystickMovable);
        //start the joystick
        this.joystickClicked = true;
          this.changeRadius(85);
        this.makeJoystick();
        this.htmlElement.style.backgroundColor = "lightgreen";
        //update
        this.moveJoystick(event);
      }
      stopJoystick() {
        //delete movable part of joystick in html
        this.htmlElement.innerText = "";
        //stop the joystick
        this.joystickClicked = false;
        this.changeRadius(60);
        this.makeJoystick();
        this.htmlElement.style.backgroundColor = "red";
        //reset stats
        this.resetStats();
        this.displayStats();
        this.translateStats();
      }
      moveJoystick(event) {
        if (this.joystickClicked){
          //update position
          this.updatePos(event);
          this.displayStats();
          //move joystickMovable
          this.moveJoystickMovable();
        }
      }
        //moving joystick movable
      moveJoystickMovable(){
        var marginVal = parseInt(window.getComputedStyle(this.htmlElement).margin, 10);
        this.joystickMovable.style.left = marginVal + this.radius - INITIALRADIUS + this.posX + "px";
        this.joystickMovable.style.bottom = marginVal + this.radius - INITIALRADIUS + this.posY + "px";
      }
        //display functions
      displayStats(){
        let uno = "Ek ", dos = "Wi ", tre = "Spe ", qua = "Ang ";
        let x = document.getElementById('x_coordinate');
        let y = document.getElementById('y_coordinate');
        let s = document.getElementById('speed');
        let a = document.getElementById('angle');
        x.innerText = Math.floor(this.posX);
        y.innerText = Math.floor(this.posY);
        s.innerText = this.spd;
        a.innerText = Math.floor(this.angl*100)/100;
        document.getElementById('e1').innerText=" "+uno.substring(x.innerText.length,4);
        document.getElementById('e2').innerText=" "+dos.substring(y.innerText.length,4);
        document.getElementById('e3').innerText=" "+tre.substring(s.innerText.length,5);
        document.getElementById('e4').innerText=" "+qua.substring(a.innerText.length,5);
      }
      resetStats(){
        this.posX=0; this.posY=0; this.spd=0;
      }
      translateStats(){
        player.speed = 8*this.spd; player.moveAngle = this.angl;
      }
    }
  </script>

</html>